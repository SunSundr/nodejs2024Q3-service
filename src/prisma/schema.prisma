generator client {
  provider = "prisma-client-js"
  previewFeatures = ["omitApi"]
}

datasource db {
  provider = "postgresql"
  url      = env("PRISMA_DATABASE_URL")
}

model user {
  id        String   @id(map: "PK_Users_Id") @db.Uuid
  login     String   @unique(map: "IX_Users_Login") @db.VarChar
  // login     String   @db.VarChar
  password  String   @db.VarChar(255)
  version   Int
  createdAt BigInt
  updatedAt BigInt
  album     album[]
  artist    artist[]
  track     track[]

  // @@unique([login], map: "UQ_User_Login")
}

model album {
  id       String  @id(map: "PK_Albums_Id") @db.Uuid
  userId   String? @db.Uuid
  favorite Boolean @default(false)
  name     String  @db.VarChar
  year     Int?
  artistId String? @db.Uuid
  artist   artist? @relation(fields: [artistId], references: [id], onUpdate: NoAction, map: "FK_Albums_Artists")
  user     user?   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "FK_Albums_Users")
  track    track[]
}

model artist {
  id       String  @id(map: "PK_Artists_Id") @db.Uuid
  userId   String? @db.Uuid
  favorite Boolean @default(false)
  name     String  @db.VarChar
  grammy   Boolean @default(false)
  album    album[]
  user     user?   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "FK_Artists_Users")
  track    track[]
}

model track {
  id       String  @id(map: "PK_Tracks_Id") @db.Uuid
  userId   String? @db.Uuid
  favorite Boolean @default(false)
  name     String  @db.VarChar
  artistId String? @db.Uuid
  albumId  String? @db.Uuid
  duration Int     @default(0)
  album    album?  @relation(fields: [albumId], references: [id], onUpdate: NoAction, map: "FK_Tracks_Albums")
  artist   artist? @relation(fields: [artistId], references: [id], onUpdate: NoAction, map: "FK_Tracks_Artists")
  user     user?   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "FK_Tracks_Users")
}

// TypeORM reference (?)
// model migrations {
//   id        Int    @id(map: "PK_Migrations_Id") @default(autoincrement())
//   timestamp BigInt
//   name      String @db.VarChar
// }
